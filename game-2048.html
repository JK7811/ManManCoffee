<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2048 Mini Â· Jkang</title>
<style>
  :root{--bg:#050507;--text:#F6F7FB;--muted:#A7AAB5;--line:rgba(255,255,255,.12);--r:22px}
  *{box-sizing:border-box}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;background:var(--bg);color:var(--text)}
  .wrap{max-width:680px;margin:0 auto;padding:18px 14px 50px}
  .top{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--line)}
  a{color:inherit;text-decoration:none}
  .card{margin-top:16px;border:1px solid var(--line);background:rgba(255,255,255,.04);border-radius:var(--r);padding:16px}
  h1{margin:0;font-size:28px}
  p{margin:8px 0;color:var(--muted);line-height:1.7}
  .hud{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .pill{padding:8px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);background:rgba(255,255,255,.02)}
  .board{
    margin-top:14px;
    width:100%;
    max-width:420px;
    aspect-ratio:1/1;
    border-radius:18px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.02);
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:10px;
    padding:10px;
  }
  .cell{
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    display:flex;align-items:center;justify-content:center;
    font-weight:900;
    font-size:22px;
    background:rgba(255,255,255,.04);
    user-select:none;
  }
  button{
    margin-top:14px;
    padding:12px 14px;border-radius:14px;border:1px solid var(--line);
    background:rgba(255,255,255,.06);color:var(--text);font-weight:900;
  }
  .hint{margin-top:10px;color:var(--muted);font-size:13px;line-height:1.7}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div style="font-weight:900;letter-spacing:.18em;text-transform:uppercase;font-size:12px">2048 Mini</div>
    <div style="color:#A7AAB5;font-size:13px"><a href="games.html">Back</a></div>
  </div>

  <div class="card">
    <h1>ğŸ§© 2048 ç®€æ˜“ç‰ˆ</h1>
    <p>æ‰‹æœºä¸Šç”¨æ»‘åŠ¨ï¼ˆä¸Šä¸‹å·¦å³ï¼‰ï¼Œç”µè„‘ç”¨æ–¹å‘é”®ã€‚</p>
    <div class="hud">
      <div class="pill">Score: <span id="score">0</span></div>
      <div class="pill">Best: <span id="best">0</span></div>
    </div>

    <div class="board" id="board"></div>
    <button id="restart">Restart</button>
    <div class="hint">æç¤ºï¼šå¦‚æœå¡ä½ï¼Œç‚¹ Restart é‡æ–°å¼€å§‹ã€‚</div>
  </div>
</div>

<script>
  const boardEl = document.getElementById('board');
  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  let grid, score=0, best=Number(localStorage.getItem('best2048')||0);
  bestEl.textContent = best;

  function emptyGrid(){
    return Array.from({length:4},()=>Array(4).fill(0));
  }
  function addRandom(){
    const empties=[];
    for(let r=0;r<4;r++) for(let c=0;c<4;c++) if(grid[r][c]===0) empties.push([r,c]);
    if(!empties.length) return false;
    const [r,c]=empties[Math.floor(Math.random()*empties.length)];
    grid[r][c] = Math.random()<0.9 ? 2 : 4;
    return true;
  }
  function render(){
    boardEl.innerHTML="";
    for(let r=0;r<4;r++){
      for(let c=0;c<4;c++){
        const v=grid[r][c];
        const d=document.createElement('div');
        d.className="cell";
        d.textContent = v? v : "";
        d.style.opacity = v? "1":"0.55";
        d.style.fontSize = v>=1024 ? "18px" : "22px";
        boardEl.appendChild(d);
      }
    }
    scoreEl.textContent=score;
    if(score>best){best=score; localStorage.setItem('best2048',best); bestEl.textContent=best;}
  }

  function slide(row){
    const arr=row.filter(v=>v);
    for(let i=0;i<arr.length-1;i++){
      if(arr[i]===arr[i+1]){
        arr[i]*=2; score+=arr[i]; arr[i+1]=0;
      }
    }
    const out=arr.filter(v=>v);
    while(out.length<4) out.push(0);
    return out;
  }

  function rotateRight(m){
    const n=4, res=emptyGrid();
    for(let r=0;r<n;r++) for(let c=0;c<n;c++) res[c][n-1-r]=m[r][c];
    return res;
  }

  function moveLeft(){
    let moved=false;
    for(let r=0;r<4;r++){
      const before=grid[r].join(",");
      grid[r]=slide(grid[r]);
      if(grid[r].join(",")!==before) moved=true;
    }
    return moved;
  }
  function move(dir){
    // 0 left, 1 up, 2 right, 3 down
    let rot=0;
    if(dir===1) rot=3;
    if(dir===2) rot=2;
    if(dir===3) rot=1;
    for(let i=0;i<rot;i++) grid=rotateRight(grid);

    const moved=moveLeft();

    for(let i=0;i<(4-rot)%4;i++) grid=rotateRight(grid);
    if(moved){ addRandom(); render(); }
  }

  function restart(){
    grid=emptyGrid(); score=0;
    addRandom(); addRandom();
    render();
  }

  // Keyboard
  window.addEventListener('keydown', (e)=>{
    if(e.key==="ArrowLeft") move(0);
    if(e.key==="ArrowUp") move(1);
    if(e.key==="ArrowRight") move(2);
    if(e.key==="ArrowDown") move(3);
  });

  // Touch swipe
  let sx=0, sy=0;
  boardEl.addEventListener('touchstart', (e)=>{
    const t=e.touches[0]; sx=t.clientX; sy=t.clientY;
  }, {passive:true});
  boardEl.addEventListener('touchend', (e)=>{
    const t=e.changedTouches[0];
    const dx=t.clientX-sx, dy=t.clientY-sy;
    if(Math.abs(dx)<25 && Math.abs(dy)<25) return;
    if(Math.abs(dx)>Math.abs(dy)){
      move(dx>0?2:0);
    }else{
      move(dy>0?3:1);
    }
  });

  document.getElementById('restart').addEventListener('click', restart);
  restart();
</script>
</body>
</html>
